{% extends 'layout.html' %}
{% load static %}
{% block content %}
<div class="pb-8">
    <!-- Ask Question Button -->
    <div class="flex justify-center px-5 py-6">
        {% if user.is_authenticated %}
            <a href="{% url 'ask_question' %}" 
               class="rounded-lg shadow-lg px-6 py-3 flex w-max items-center bg-gradient-to-tr from-[#0f766e] to-teal-500 hover:from-[#115e57] hover:to-teal-600 transition-all duration-300 transform hover:scale-105">
                <svg class="w-5 h-5 mr-2 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                </svg>
                <span class="font-bold text-white tracking-wide">Ask a Question</span>
            </a>
        {% endif %}
    </div>

    <!-- Question List -->
    <div class="max-w-2xl mx-auto">
        {% for post in object_list %}
            <div class="rounded-xl shadow-md border border-gray-200 bg-white/80 m-4 p-5 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 backdrop-blur-md">
                
                <!-- Header with Owner Initial and Date -->
                <div class="flex items-center mb-3">
                    <div class="w-full h-9 rounded-full bg-teal-100 flex items-center justify-between px-3">
                        <span class="text-[#0f766e] font-bold text-lg">{{ post.owner|slice:":1" }}</span>
                        <span class="text-xs text-gray-500">{{ post.time }} | {{ post.date }}</span>
                    </div>
                </div>

                <!-- Question Body -->
                <h2 class="break-words mb-3 text-lg font-medium text-gray-800 flex items-center justify-between">
                    <a href="{% url 'question_detail' post.pk %}" class="hover:text-[#0f766e] transition-colors">
                        {{ post.body }}
                    </a>
                    <a href="{% url 'question_detail' post.pk %}" 
                       class="text-2xl text-[#0f766e] hover:text-[#115e57] transition-colors">→</a>
                </h2>

                <!-- Replies & Reply Button -->
                <div class="flex justify-between items-center text-gray-600 mt-2">
                    <div class="flex items-center gap-2 text-sm">
                        {% if post.replys.count > 0 %}
                            <button 
                                class="bg-teal-50 text-[#0f766e] px-3 py-1 rounded-full focus:outline-none transition flex items-center gap-1"
                                onclick="toggleReplies('replies-{{ post.pk }}', this)"
                                id="view-replies-btn-{{ post.pk }}">
                                <span>View {{ post.replys.count }} Replies</span>
                                <svg class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                        {% else %}
                            <span class="bg-gray-100 text-gray-500 px-3 py-1 rounded-full">No replies yet</span>
                        {% endif %}
                    </div>
                    {% if user.is_authenticated %}
                        <a class="text-[#0f766e] hover:underline text-sm font-semibold" href="{% url "question_detail" post.pk %}">Reply</a>
                    {% endif %}
                </div>

                <!-- Replies Section -->
                {% if post.replys.count > 0 %}
                    <div id="replies-{{ post.pk }}" class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out bg-teal-50 rounded-lg mt-4 px-4 py-2">
                        {% for reply in post.replys.all %}
                            <div class="border-b border-teal-100 py-2 flex flex-col items-start gap-1">
                                <div>
                                    <span class="font-bold text-[#0f766e]">{{ reply.owner.username }}</span>
                                    <span class="text-gray-600 text-xs">{{ reply.time }} | {{ reply.date }}</span>
                                </div>
                                <span class="ml-1 text-gray-800">{{ reply.reply }}</span>
                            </div>
                        {% empty %}
                            <div class="text-gray-500 py-2">No replies yet.</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="flex justify-center items-center text-sm text-gray-500 my-8 gap-6">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}" 
                   class="px-3 py-1 rounded bg-teal-100 hover:bg-teal-200 text-[#0f766e] transition">← Previous</a>
            {% endif %}
            <span class="font-medium">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" 
                   class="px-3 py-1 rounded bg-teal-100 hover:bg-teal-200 text-[#0f766e] transition">Next →</a>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Reply Toggle Script -->
<script>
function toggleReplies(id, btn) {
    const div = document.getElementById(id);
    const icon = btn.querySelector("svg");
    if (div.classList.contains('max-h-0')) {
        div.classList.remove('max-h-0');
        div.classList.add('max-h-96');
        icon.classList.add('rotate-180');
        div.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } else {
        div.classList.remove('max-h-96');
        div.classList.add('max-h-0');
        icon.classList.remove('rotate-180');
    }
}
</script>
{% endblock %}
